<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.lyh.shortlink.project.dao.mapper.ShortLinkMapper">
    <update id="incrementStats">
        update `t_link`
        set total_pv  = total_pv + #{totalPv},
            total_uv  = total_uv + #{totalUv},
            total_uip = total_uip + #{totalUip}
        where gid = #{gid}
          and full_short_url = #{fullShortUrl}
    </update>

    <select id="listGroupShortLinkCount"
            resultType="com.lyh.shortlink.project.dto.response.ShortLinkGroupCountQueryRespDTO">
        SELECT gid, COUNT(*) as shortLinkCount FROM `t_link`
        WHERE enable_status = 0 AND del_flag=0 AND gid IN
        <foreach collection="gids" item="gid" open="(" separator="," close=")">
            #{gid}
        </foreach>
        GROUP BY gid
    </select>
</mapper>